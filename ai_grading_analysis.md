# AI 批改系统 — 技术分析报告

> 生成时间：2026-02-22  
> 项目路径：`c:\Users\madou\projects\outer\ai_grading`

---

## 一、系统架构概览

支持科目：**中文**（阅读/作文）、**英文**（阅读/作文）、**数学**

核心处理流程：

```
上传试卷 (JPG/PNG/PDF)
        ↓
    [ OCR 层 ]
        ↓
  ┌─────┬────────┬─────┐
  中文    英文    数学
  阅读   阅读    题目抽取
  作文   作文    计算验证
  ↓      ↓       ↓
     LLM 批改层
        ↓
   结构化批改报告
```

---

## 二、OCR 核心选型

### 2026 年顶尖开源 OCR 模型对比

| 模型                 | 精度       | 文档结构理解 | 批量处理 | 手写体 |
| -------------------- | ---------- | ------------ | -------- | ------ |
| **PaddleOCR-VL-1.5** | ⭐⭐⭐⭐   | ⭐⭐⭐⭐     | ⭐⭐⭐   | ⭐⭐⭐ |
| **DeepSeek-OCR 2**   | ⭐⭐⭐⭐   | ⭐⭐⭐       | ⭐⭐⭐⭐ | ⭐⭐   |
| **InternVL 2.5**     | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐     | ⭐⭐⭐   | ⭐⭐⭐ |
| **Qwen2.5-VL**       | ⭐⭐⭐⭐   | ⭐⭐⭐⭐⭐   | ⭐⭐⭐   | ⭐⭐⭐ |
| **LightOnOCR**       | ⭐⭐⭐     | ⭐⭐         | ⭐⭐⭐⭐ | ⭐⭐   |

### 各科目 OCR 推荐

| 科目              | OCR 挑战                   | 推荐模型                        | 原因                           |
| ----------------- | -------------------------- | ------------------------------- | ------------------------------ |
| **中文阅读/作文** | 手写中文、阅卷格子         | `PaddleOCR-VL-1.5`              | 专门优化中文手写、结构化文档   |
| **英文阅读/作文** | 手写英文、混排             | `PaddleOCR-VL-1.5`              | 综合精度 94.5%，结构理解强     |
| **数学**          | 数字、符号、手写算式、图形 | `DeepSeek-OCR 2` + `Qwen2.5-VL` | 端到端理解公式逻辑，并自动批改 |

---

## 三、数学试卷的四个核心问题

### Q1：是否需要训练数据？

**结论：初期不需要，中期需要微调。**

- **阶段一（MVP）**：直接使用 `DeepSeek-OCR 2` 或 `Qwen2.5-VL` 的零样本（zero-shot）能力，通过精心设计的 Prompt 进行题目识别和批改，对标准印刷体数学试卷效果已经很好。
- **阶段二（提升精度）**：针对 **手写答题卡**（潦草数字、自制符号等），建议收集 500~2000 张标注样图做 **LoRA 微调**，提升手写数字和分步骤解法的识别精度。
- **关键数据来源**：`math/` 目录下的 9 份 PDF 是很好的起始数据，可用于标注和模型评估。

---

### Q2：是否需要多模型配合？

**结论：是的，推荐三层模型协作架构。**

```
┌─────────────────────────────────────────────────────┐
│  第一层：视觉理解层                                   │
│  Qwen2.5-VL / InternVL-2.5                          │
│  → 将试卷图像转为结构化 JSON（题号+题干+学生答案）       │
├─────────────────────────────────────────────────────┤
│  第二层：数学计算验证层                               │
│  SymPy（符号计算）/ DeepSeek-Math / Wolfram Engine   │
│  → 对每道题的学生答案进行数学正确性验算                 │
├─────────────────────────────────────────────────────┤
│  第三层：批改报告层                                   │
│  DeepSeek-V3 / GPT-4o                               │
│  → 生成详细批改说明、错误分析、改进建议                 │
└─────────────────────────────────────────────────────┘
```

分层设计的优点：**各层可独立替换升级**，避免单点失败，便于 A/B 测试不同模型。

---

### Q3：如何从试卷中提取题目和学生答案？

**核心难点**：区分 **题干区域**（印刷体）和 **答题区域**（手写体）。

**处理流程示意：**

```python
# Step 1: 版面分析 - 识别题目结构
prompt = """
分析这张数学试卷图片，请以 JSON 格式提取所有题目：
{
  "questions": [
    {
      "question_id": "第1题",
      "question_text": "题目内容（包含公式）",
      "student_answer": "学生手写的答案区域内容",
      "answer_area_type": "填空/选择/计算"
    }
  ]
}
只提取题目和学生的作答，不要包含标准答案栏。
"""
# Step 2: 调用 VLM (Qwen2.5-VL API) 处理试卷图片
# Step 3: 解析 JSON，进入数学验证层
```

**关键策略：**

- 利用 VLM 的 **视觉定位能力**，让模型同时识别"印刷体题目"和"手写答案"并分区
- 对于多页试卷，需要 **题号连续性追踪**（跨页识别同一题的完整作答）
- 建议输出采用标准 JSON Schema，便于后续层消费

---

### Q4：如何判断答题是否正确？

**推荐三种验证机制并联：**

| 机制             | 适用题型                 | 工具                             |
| ---------------- | ------------------------ | -------------------------------- |
| **精确数学计算** | 计算题、代数题           | `SymPy` 符号计算引擎             |
| **VLM 逻辑判断** | 几何证明、应用题分析过程 | `DeepSeek-Math` / `Qwen2.5-Math` |
| **标准答案比对** | 选择题、填空题           | 正则匹配 + 模糊匹配              |

**示例验证逻辑：**

```
题目：计算 (2x+3)²
学生答：4x²+9

SymPy 验证：
  expand((2*x+3)**2) = 4*x² + 12*x + 9
  学生答案 4*x² + 9 ≠ 4*x² + 12*x + 9
  → ❌ 错误

DeepSeek-Math 分析：
  → 指出"缺少交叉项 12x，属于完全平方公式记忆错误"
  → 给出知识点提示和改进建议
```

---

## 四、实施路线图

```
第一阶段（MVP，2~3周）
├── ✅ 搭建 OCR Pipeline：Qwen2.5-VL 处理数学 PDF
├── ✅ 实现题目抽取 JSON 结构化输出
└── ✅ SymPy 验证计算题正确性

第二阶段（完善，4~6周）
├── 接入 PaddleOCR-VL 处理中英文手写
├── 实现作文/阅读批改 Prompt 工程
└── 数学手写答案微调数据收集（用现有9个PDF标注）

第三阶段（生产，2~3月）
├── 多模型结果 ensemble（投票/置信度加权）
├── 手写识别 LoRA 微调
└── 反馈闭环收集（老师纠错 → 训练数据）
```

---

## 五、关于 `math/` 目录样卷

`math/` 目录下共有 **9 份数学 PDF 试卷**，是项目的核心初始数据：

| 用途              | 建议操作                                                 |
| ----------------- | -------------------------------------------------------- |
| **模型评估基准**  | 用 Qwen2.5-VL 和 PaddleOCR-VL-1.5 各跑一遍，对比识别效果 |
| **标注种子数据**  | 手工标注 50~100 题的 `(题目, 学生答案, 正确性)` 三元组   |
| **LoRA 微调数据** | 中期收集更多样例后用于微调                               |

---

## 六、立即可行的验证步骤

1. **环境准备**：安装 `pdf2image`、`openai`（或对应 VLM SDK）、`sympy`
2. **PDF 转图片**：将 `math/*.pdf` 转为高分辨率 PNG
3. **调用 Qwen2.5-VL**：使用结构化 Prompt 提取题目 JSON
4. **SymPy 验证**：对计算题答案进行符号计算验证
5. **汇总报告**：生成每道题识别结果 + 正确性判断的对比表

---

_本报告基于 2026 年 2 月最新开源模型评估，建议定期更新。_
